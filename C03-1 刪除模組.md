# C03-1 刪除模組

### 測試方式
```
node main.js
```

### 執行結果
![GitHub Logo](/imgs/results03-1.jpg)


### 檔案放置方式
```
|__ main.js
|   
|__ <utility>
        |__ asyncDB.js    
        |__ deleteProduct.js  	
```

### (1) asyncDB.js

``` js
'use strict';

//-----------------------
// 引用資料庫模組
//-----------------------
const {Client} = require('pg');

//-----------------------
// 自己的資料庫連結位址
//-----------------------
var pgConn = 'postgres://自己的URI資料';


//產生可同步執行query物件的函式
function query(sql, value=null) {
    return new Promise((resolve, reject) => {
        //設定資料庫連線物件
        var client = new Client({
            connectionString: pgConn,
            ssl: true
        })     

        //連結資料庫
        client.connect();

        //回覆查詢結果  
        client.query(sql, value, (err, results) => {                   
            if (err){
                reject(err);
            }else{			
                resolve(results);
            }

            //關閉連線
            client.end();
        });
    });
}

//匯出
module.exports = query;
```



### (2) deleteProduct.js  
``` js
'use strict';

//引用操作資料庫的物件
const query = require('./asyncDB');

//----------------------------------
// 刪除商品
//----------------------------------
var deleteProduct = async function(prono){
    var result;

    await query('DELETE FROM product WHERE prono = $1', [prono])
        .then((data) => {
            result = data.rowCount;  
        }, (error) => {
            result = -1;
        });
		
    return result;
}
//----------------------------------

//匯出
module.exports = deleteProduct;
```


### (3) main.js
``` js
'use strict';

//引用函式
const deleteProduct = require('./utility/deleteProduct');

//刪除編號
var proNo = 'P200';

//執行函式
deleteProduct(proNo).then(d => {
    if(d>=0){
        console.log('已刪除' + d + '筆資料');        
    }else{
        console.log('刪除失敗');
    }
})
```
